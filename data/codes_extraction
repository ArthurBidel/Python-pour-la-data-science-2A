import os
import pandas as pd

# Dossier principal contenant les sous-dossiers
dossier_principal = "/chemin/vers/ton/dossier_principal"

# Dictionnaire pour stocker les DataFrames de chaque sous-dossier
tables_par_sous_dossier = {}

# Parcourir chaque sous-dossier dans le dossier principal
for sous_dossier in os.listdir(dossier_principal):
    chemin_sous_dossier = os.path.join(dossier_principal, sous_dossier)
    
    # Vérifie que c'est bien un dossier
    if os.path.isdir(chemin_sous_dossier):
        # Liste pour stocker les DataFrames de chaque CSV dans le sous-dossier
        df_list = []
        
        # Parcourir chaque fichier CSV dans le sous-dossier
        for fichier in os.listdir(chemin_sous_dossier):
            if fichier.endswith(".csv"):
                chemin_fichier = os.path.join(chemin_sous_dossier, fichier)
                
                # Lire le CSV et l'ajouter à la liste
                df = pd.read_csv(chemin_fichier)
                df_list.append(df)
        
        # Concatenation des DataFrames du sous-dossier
        if df_list:
            table = pd.concat(df_list, ignore_index=True)
            tables_par_sous_dossier[sous_dossier] = table  # Stocke la table pour chaque sous-dossier

# Affiche le dictionnaire avec les tables
for sous_dossier, table in tables_par_sous_dossier.items():
    print(f"Table pour le sous-dossier '{sous_dossier}':")
    print(table)
    print("\n")



import requests
import zipfile
import tarfile
import os

# URL du fichier à télécharger
url = "https://example.com/fichier.zip"  # Remplace par ton URL

# Dossier de destination pour enregistrer le fichier téléchargé et les extractions
dossier_destination = "/workspace/dossier_destination"  # Sur Onyxia

# Assure-toi que le dossier de destination existe
os.makedirs(dossier_destination, exist_ok=True)

# Chemin du fichier téléchargé
fichier_telecharge = os.path.join(dossier_destination, "fichier.zip")

# Téléchargement du fichier
print("Téléchargement en cours...")
response = requests.get(url, stream=True)
with open(fichier_telecharge, "wb") as file:
    for chunk in response.iter_content(chunk_size=8192):
        file.write(chunk)
print("Téléchargement terminé.")

# Extraction si c'est un fichier ZIP
if fichier_telecharge.endswith(".zip"):
    print("Extraction de l'archive ZIP...")
    with zipfile.ZipFile(fichier_telecharge, "r") as zip_ref:
        zip_ref.extractall(dossier_destination)
    print("Extraction terminée.")

# Extraction si c'est un fichier TAR.GZ
elif fichier_telecharge.endswith(".tar.gz"):
    print("Extraction de l'archive TAR.GZ...")
    with tarfile.open(fichier_telecharge, "r:gz") as tar_ref:
        tar_ref.extractall(dossier_destination)
    print("Extraction terminée.")

# Optionnel : Supprimer le fichier téléchargé une fois extrait
os.remove(fichier_telecharge)

print("Tous les fichiers sont disponibles dans:", dossier_destination)
